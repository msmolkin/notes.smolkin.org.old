<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="aws file transcription TL;DR: Still not finished. This tells you how to take an audio file, upload it to AWS (assuming you&rsquo;ve already created a bucket, either with something like aws s3 mb recordings or manually via the website), create a user account (they call it an &ldquo;IAM User&rdquo;) with the necessary permissions, transcribe the file, and then manually submit a batch job to translate it."><meta property="og:title" content="2023-07-26 Creating a simple transcription/translation script with AWS"><meta property="og:description" content="aws file transcription TL;DR: Still not finished. This tells you how to take an audio file, upload it to AWS (assuming you&rsquo;ve already created a bucket, either with something like aws s3 mb recordings or manually via the website), create a user account (they call it an &ldquo;IAM User&rdquo;) with the necessary permissions, transcribe the file, and then manually submit a batch job to translate it."><meta property="og:type" content="website"><meta property="og:image" content="https://notes.smolkin.org/icon.png"><meta property="og:url" content="https://notes.smolkin.org/notes/2023-07-26/"><meta property="og:width" content="200"><meta property="og:height" content="200"><meta name=twitter:card content="summary"><meta name=twitter:title content="2023-07-26 Creating a simple transcription/translation script with AWS"><meta name=twitter:description content="aws file transcription TL;DR: Still not finished. This tells you how to take an audio file, upload it to AWS (assuming you&rsquo;ve already created a bucket, either with something like aws s3 mb recordings or manually via the website), create a user account (they call it an &ldquo;IAM User&rdquo;) with the necessary permissions, transcribe the file, and then manually submit a batch job to translate it."><meta name=twitter:image content="https://notes.smolkin.org/icon.png"><meta name=twitter:site content="MichaelSmolkin"><title>2023-07-26 Creating a simple transcription/translation script with AWS</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://notes.smolkin.org//icon.png><link href=https://notes.smolkin.org/styles.19109a40042e9f0e72e952fda4442a34.min.css rel=stylesheet><link href=https://notes.smolkin.org/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://notes.smolkin.org/js/darkmode.c7ba66b6717fa2f16a94f2cd9928a34e.min.js></script>
<script src=https://notes.smolkin.org/js/util.00639692264b21bc3ee219733d38a8be.min.js></script>
<link rel=preload href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css as=style onload='this.onload=null,this.rel="stylesheet"' integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/core@1.2.1></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/dom@1.2.1></script>
<script defer src=https://notes.smolkin.org/js/popover.aa9bc99c7c38d3ae9538f218f1416adb.min.js></script>
<script defer src=https://notes.smolkin.org/js/code-title.ce4a43f09239a9efb48fee342e8ef2df.min.js></script>
<script defer src=https://notes.smolkin.org/js/clipboard.2913da76d3cb21c5deaa4bae7da38c9f.min.js></script>
<script defer src=https://notes.smolkin.org/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const SEARCH_ENABLED=!1,LATEX_ENABLED=!0,PRODUCTION=!0,BASE_URL="https://notes.smolkin.org/",fetchData=Promise.all([fetch("https://notes.smolkin.org/indices/linkIndex.a890b15bc03ed6581414671fe65bbef9.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://notes.smolkin.org/indices/contentIndex.5a9c1577521ca1ba09ee248659685871.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://notes.smolkin.org",!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!1;drawGraph("https://notes.smolkin.org",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}var i=document.getElementsByClassName("mermaid");i.length>0&&import("https://unpkg.com/mermaid@9/dist/mermaid.esm.min.mjs").then(e=>{e.default.init()});function a(n){const e=n.target,t=e.className.split(" "),s=t.includes("broken"),o=t.includes("internal-link");plausible("Link Click",{props:{href:e.href,broken:s,internal:o,graph:!1}})}const r=document.querySelectorAll("a");for(link of r)link.className.includes("root-title")&&link.addEventListener("click",a,{once:!0})},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'’':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/notes.smolkin.org\/js\/router.d6fe6bd821db9ea97f9aeefae814d8e7.min.js"
    attachSPARouting(init, render)
  </script><script defer data-domain=notes.smolkin.org src=https://plausible.io/js/script.js></script>
<script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script></head><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://notes.smolkin.org/js/full-text-search.e6e2e0c213187ca0c703d6e2c7a77fcd.min.js></script><div class=singlePage><header><h1 id=page-title><a class=root-title href=https://notes.smolkin.org/>🧠 M's Musings</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>2023-07-26 Creating a simple transcription/translation script with AWS</h1><p class=meta>Last updated
Jul 26, 2023
<a href=https://github.com/msmolkin/notes.smolkin.org/tree/hugo/content/notes/2023-07-26.md rel=noopener>Edit Source</a></p><ul class=tags><li><a href=https://notes.smolkin.org/tags/blog/>Blog</a></li></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><ol><li><a href=#aws-file-transcription>aws file transcription</a></li></ol></li></ol></nav></details></aside><a href=#aws-file-transcription><h3 id=aws-file-transcription><span class=hanchor arialabel=Anchor># </span>aws file transcription</h3></a><p>TL;DR: Still not finished. This tells you how to take an audio file, upload it to AWS (assuming you&rsquo;ve already created a bucket, either with something like <code>aws s3 mb recordings</code> or manually via the website), create a user account (they call it an &ldquo;IAM User&rdquo;) with the necessary permissions, transcribe the file, and then manually submit a batch job to translate it. Translating via terminal/programmatically is a headache that I still haven&rsquo;t figured out. It involves temporary permissions (they call them &ldquo;IAM Roles&rdquo;), instead of just giving the user account permission. That&rsquo;s all that&rsquo;s remaining for this to be a complete tutorial to automate permissions.</p><p>Bonus! I also included a <a href=/notes/2023-07-26-GPT-prompt rel=noopener class=internal-link data-src=/notes/2023-07-26-GPT-prompt>2023-07-26 GPT prompt</a></p><a href=#create-user-to-do-transcriptions><h5 id=create-user-to-do-transcriptions><span class=hanchor arialabel=Anchor># </span>Create user to do transcriptions</h5></a><p>Run the following commands in the cloud console (or on your machine which already has access to the AWS CLI. Since I didn&rsquo;t want to bother with downloading and configuring the CLI, I chose the cloud console). To access the console Go to <code>https://us-east-1.console.aws.amazon.com/iamv2/home?region=us-east-1#/users</code> -> and click on the console button, which looks like this: <a class="globalNav-0291 globalNav-029 globalNav-0210 _icon-color_izqbm_6" href="https://us-east-1.console.aws.amazon.com/cloudshell/home?region=us-east-1" title=CloudShell target=_self rel="noreferrer noopener" id=awsc-nav-scallop-icon data-testid=awsc-nav-scallop-icon data-tools-experience-ingress-point=cloudshell-icon-header><svg xmlns="http://www.w3.org/2000/svg" version="2.0" focusable="false" aria-hidden="true" class="globalNav-0216" width="16" height="16" viewBox="0 0 16 16"><path d="M5 5l2.997 2.998L5 11m4.997-.002H12m3-7.626A2.374 2.374.0 0012.627 1H3.37A2.372 2.372.0 001 3.372v9.256a2.373 2.373.0 002.37 2.373h9.257A2.375 2.375.0 0015 12.628V3.372z" stroke="currentcolor" stroke-width="2" stroke-miterlimit="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg></a></p><ol><li><code>aws iam create-user --user-name TranscribeUser</code></li><li><code>aws iam attach-user-policy --user-name TranscribeUser --policy-arn arn:aws:iam::aws:policy/AmazonS3FullAccess</code></li><li><code>aws iam attach-user-policy --user-name TranscribeUser --policy-arn arn:aws:iam::aws:policy/AmazonTranscribeFullAccess</code></li><li><code>aws iam create-access-key --user-name TranscribeUser</code> <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></li><li><code>aws iam attach-user-policy --user-name TranscribeUser --policy-arn arn:aws:iam::aws:policy/TranslateFullAccess</code> (figured it out by running <del><code>export POLICYARN=$(aws iam list-policies --query 'Policies[?PolicyName==`TranslateFullAccess`].{ARN:Arn}' --output text)</code></del> <code>aws iam list-policies</code> from AWS&rsquo;s
<a href=https://docs.aws.amazon.com/cli/latest/userguide/cli-services-iam-policy.html rel=noopener>how-to page</a> and searching through the results)</li></ol><a href=#upload-files-and-run-transcription-command><h5 id=upload-files-and-run-transcription-command><span class=hanchor arialabel=Anchor># </span>Upload files and run transcription command</h5></a><ol start=6><li>Then figure out how to upload the files from my Mac to the S3 bucket programmatically. For now, uploaded manually by opening the
<a href="https://s3.console.aws.amazon.com/s3/upload/recordings.smolkin.org?region=us-west-1" rel=noopener>S3 bucket</a><ol><li>I set this up on EC2 and did this just a couple days ago with the log files, so it can&rsquo;t be too hard to set up on my Mac</li><li>Here&rsquo;s the command I&rsquo;ll run: <code>aws s3 cp /path/to/your/audio/file s3://your-bucket-name/path/in/bucket/</code></li></ol></li><li>When using the AWS CLI, you&rsquo;ll need to handle special characters, such as spaces, by enclosing the S3 URL in double quotes to prevent parsing errors. Well, you should escape the spaces in the S3 URL using backslashes or enclose it in double quotes, if there&rsquo;s an error.<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></li><li>Transcribe the recordings (can be run inside cloud console as well).<ol><li>No matter how hard I tried, I was unable to get GPT-3.5 to generate the command properly for me.<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> FINALLY! The issue was how <code>--media</code> was supposed to be handled: <code>--media MediaFileUri=s3://{bucket_name}/path/to/file</code></li><li>Update: it&rsquo;s best to put these inside a separate folder that contains nothing from previous days, as all files in this directory will be used when generating the translation. So don&rsquo;t use <code>recordings.smokin.org/results</code>, rather use <code>recordings.smolkin.org/results/transcriptions/{today's date}</code></li></ol></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># Transcribe New Recording 8.m4a
</span></span><span class=line><span class=cl>aws transcribe start-transcription-job --transcription-job-name BoruchGorin1-Recording8-IsPutinAFriendToTheJews --language-code ru-RU --media MediaFileUri=s3://recordings.smolkin.org/BoruchGorinLectureAudiosForDad/New\\ Recording\\ 8.m4a --output-bucket-name recordings.smolkin.org --output-key results/transcriptions/$(date +%Y-%m-%d)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Transcribe New Recording 9.m4a
</span></span><span class=line><span class=cl>aws transcribe start-transcription-job --transcription-job-name BoruchGorin2-Recording9-HowLongCanJewsStayInRussia --language-code ru-RU --media MediaFileUri=s3://recordings.smolkin.org/BoruchGorinLectureAudiosForDad/New\ Recording\ 9.m4a --output-bucket-name recordings.smolkin.org --output-key results/transcriptions/$(date +%Y-%m-%d)
</span></span></code></pre></td></tr></table></div></div><a href=#retrieve-completed-transcriptions><h5 id=retrieve-completed-transcriptions><span class=hanchor arialabel=Anchor># </span>Retrieve completed transcriptions</h5></a><ol start=9><li>List all transcription jobs in your AWS account, including their status, and you can check if the new job with your specified job name has completed successfully: <code>aws transcribe list-transcription-jobs</code><ol><li>You can also run it with the specific job name: <code>aws transcribe list-transcription-jobs --query "TranscriptionJobSummaries[?TranscriptionJobName=='BoruchGorin1-Recording8-IsPutinAFriendToTheJews']"</code></li></ol></li><li>Once the transcription job is completed (i.e. <code>TranscriptionJobSummaries[?TranscriptionJobName<mark>{JobName}]["TranscriptionJobStatus"]</mark> "COMPLETED"</code>, you can use the AWS CLI to retrieve the transcription results: <code>aws transcribe get-transcription-job --transcription-job-name BoruchGorin1-Recording8-IsPutinAFriendToTheJews --output json</code></li><li>This part is much better to do once you have that IAM access working (otherwise, accessing files is a huge pain with AWS S3): The transcription results are stored in the S3 bucket and folder/object specified by the <code>OutputBucketName</code> and <code>OutputKey</code> parameters when the job was created. You can use the <code>cp</code> command to copy the transcription file from S3 to the local computer/server: <code>aws s3 cp s3://recordings.smolkin.org/results/BoruchGorin1-Recording8-IsPutinAFriendToTheJews.json ./</code>, <code>aws s3 cp s3://recordings.smolkin.org/results/BoruchGorin2-Recording9-HowLongCanJewsStayInRussia.json ./</code></li><li>Create a transitional text file that will be used for the automated translation. Also, this is the result of the transcription. Hooray!</li></ol><p>11:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=k>for</span> file in *.json<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=nv>jobName</span><span class=o>=</span><span class=k>$(</span>jq -r <span class=s1>&#39;.jobName&#39;</span> <span class=s2>&#34;</span><span class=nv>$file</span><span class=s2>&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>    <span class=nv>jobDetails</span><span class=o>=</span><span class=k>$(</span>aws transcribe list-transcription-jobs --query <span class=s2>&#34;TranscriptionJobSummaries[?TranscriptionJobName==&#39;</span><span class=si>${</span><span class=nv>jobName</span><span class=si>}</span><span class=s2>&#39;]&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>    <span class=nv>languageCode</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$jobDetails</span><span class=s2>&#34;</span> <span class=p>|</span> jq -r <span class=s1>&#39;.[0].LanguageCode&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>    <span class=nv>completionTime</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$jobDetails</span><span class=s2>&#34;</span> <span class=p>|</span> jq -r <span class=s1>&#39;.[0].CompletionTime&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>    <span class=nv>fileNameDate</span><span class=o>=</span><span class=k>$(</span>date -d <span class=s2>&#34;</span><span class=nv>$completionTime</span><span class=s2>&#34;</span> +<span class=s1>&#39;%Y-%m-%d_%H-%M-%S&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>    <span class=nv>fileName</span><span class=o>=</span><span class=s2>&#34;./</span><span class=si>${</span><span class=nv>jobName</span><span class=si>}</span><span class=s2>_</span><span class=si>${</span><span class=nv>languageCode</span><span class=si>}</span><span class=s2>_</span><span class=si>${</span><span class=nv>fileNameDate</span><span class=si>}</span><span class=s2>_transcript.txt&#34;</span>
</span></span><span class=line><span class=cl>    jq -r <span class=s1>&#39;.results.transcripts[0].transcript&#39;</span> <span class=s2>&#34;</span><span class=nv>$file</span><span class=s2>&#34;</span> &gt; <span class=s2>&#34;</span><span class=nv>$fileName</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=c1># en and en-US both work</span>
</span></span><span class=line><span class=cl>    <span class=c1># aws translate start-text-translation-job --input-data-config S3Uri=&#34;s3://recording.smolkin.org/results/$file&#34; --output-data-config S3Uri=&#34;s3://recording.smolkin.org/results/$outputFileName&#34; --data-access-role-arn arn:aws:iam::021741100599:role/TranslateFullAccess --source-language-code &#34;$languageCode&#34; --target-language-codes en-US # Error: first couldn&#39;t create IAM keys and get arn to work</span>
</span></span><span class=line><span class=cl>	<span class=c1># translatedFileName=&#34;./${jobName}_${languageCode}_${fileNameDate}_translated.txt&#34;; aws translate translate-text --text &#34;$(cat &#34;$fileName&#34;)&#34; --source-language-code &#34;$languageCode&#34; --target-language-code en --output text &gt; &#34;$translatedFileName&#34; # Error: An error occurred (TextSizeLimitExceededException) when calling the TranslateText operation: Input text size exceeds limit. Max length of request text allowed is 10000 bytes while in this request the text size is 41011 bytes</span>
</span></span><span class=line><span class=cl>    <span class=c1># for file in *_transcript.txt; do transcribedText=$(cat &#34;$file&#34;); translatedText=$(aws translate translate-text --text &#34;$transcribedText&#34; --source-language-code $languageCode --target-language-code en); echo &#34;$translatedText&#34; &gt; &#34;${file%.txt}_en.txt&#34;; done # never checked this one</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span></code></pre></td></tr></table></div></div><p><sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>
13. Send the file(s) to AWS Translate [Synchronous, O(n^2) solution (moved to the bottom of the document, because it has too many flaws)]. This can actually be done without step 11. Step 11 can be replaced with just two more calls to the API.</p><a href=#translate-transcriptions-and-download-files><h5 id=translate-transcriptions-and-download-files><span class=hanchor arialabel=Anchor># </span>Translate transcriptions and download files</h5></a><ol start=14><li>(Optional: AWS CloudShell Directions) If this was done in the AWS CloudShell, download all resulting files to the desktop. This step should be unnecessary, once all permissions have been configured and it&rsquo;s done completely in the cloud<ol><li>Go to the directory (probably <code>~</code>) where you saved all your requests. <code>cd; ls</code>. Copy the output of <code>ls</code></li><li>In the upper right corner of the CloudShell, click &lsquo;Actions<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" focusable="false" aria-hidden="true"><path class="filled stroke-linejoin-round" d="M4 5h8l-4 6-4-6z"/></svg> -> Download file&rsquo; <a class="internal-link broken">Screenshot 2023-07-26 at 10.09.53 AM.png</a></li><li>Sequentially, paste the path to each file and press Download</li></ol></li><li>Manual:<ol><li>If doing just a couple files, I can manually do the translations. After completing step 14, go to <code>https://us-west-1.console.aws.amazon.com/translate/home?region=us-west-1#translation</code> and upload the file there</li><li>Or I can manually run the batches:<ol><li>Copy the files back to the folder from which you&rsquo;ll be calling them: <code>aws s3 cp BoruchGorin2-Recording9-HowLongCanJewsStayInRussia_ru-RU_2023-07-26_06-04-30_transcript.txt s3://recordings.smolkin.org/transcriptions/$(date +%Y-%m-%d)</code><ol><li>⚠️ don&rsquo;t forget the <code>/</code> at the end of the folder name! otherwise, s3 will actually copy your file to a new file with the same name as the directory, e.g. creating a new file called &ldquo;s3://recordings.smolkin.org/transcriptions&rdquo;</li><li>the output folder creates a directory for this job. the input folder uses all files in the input. so you need to separate files in this job from files in other jobs, probably by using a subdirectory. this is relevant when making the output of the transcription, so you don&rsquo;t have to move the file once it gets to this point</li></ol></li><li><a href="https://us-west-1.console.aws.amazon.com/translate/home?region=us-west-1#create-batch-translation" rel=noopener>https://us-west-1.console.aws.amazon.com/translate/home?region=us-west-1#create-batch-translation</a></li><li>Just ran the AWS translation using the website. I should&rsquo;ve done this from the start. They still don&rsquo;t give me a CLI command to do this automatically, but they were willing to generate an AWS Translate IAM role for me that works (although IDK how to use it outside of manually using the AWS translation batch)</li><li>To retrieve the data:<ol><li>Open the job:
<a href="https://us-west-1.console.aws.amazon.com/translate/home?region=us-west-1#batch-details/126ac04db7b95bb1bb0f03b541d19cb8" rel=noopener>https://us-west-1.console.aws.amazon.com/translate/home?region=us-west-1#batch-details/126ac04db7b95bb1bb0f03b541d19cb8</a></li><li>Then click on &ldquo;Output file location&rdquo; <a class="internal-link broken">Screenshot 2023-07-26 at 11.15.59 AM.png</a></li><li>And then get to the file data and click &ldquo;Open&rdquo; or &ldquo;Download&rdquo;</li></ol></li></ol></li></ol></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;AccessKey&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;UserName&#34;</span><span class=p>:</span> <span class=s2>&#34;TranscribeUser&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;AccessKeyId&#34;</span><span class=p>:</span> <span class=s2>&#34;[the access key is here]&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;Status&#34;</span><span class=p>:</span> <span class=s2>&#34;Active&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;SecretAccessKey&#34;</span><span class=p>:</span> <span class=s2>&#34;[the key secret is here]&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;CreateDate&#34;</span><span class=p>:</span> <span class=s2>&#34;2023-07-26T00:40:31+00:00&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Useless links:
<a href=https://docs.aws.amazon.com/transcribe/latest/dg/service_code_examples.html rel=noopener>https://docs.aws.amazon.com/transcribe/latest/dg/service_code_examples.html</a>
<a href=https://docs.aws.amazon.com/sdk-for-javascript/v3/developer-guide/transcribe-examples-section.html rel=noopener>https://docs.aws.amazon.com/sdk-for-javascript/v3/developer-guide/transcribe-examples-section.html</a>
<a href=https://docs.aws.amazon.com/cli/latest/reference/transcribe/start-transcription-job.html rel=noopener>https://docs.aws.amazon.com/cli/latest/reference/transcribe/start-transcription-job.html</a>
<a href=https://docs.aws.amazon.com/transcribe/latest/dg/how-input.html#how-input-audio rel=noopener>https://docs.aws.amazon.com/transcribe/latest/dg/how-input.html#how-input-audio</a>
Useful link:
<a href=https://docs.aws.amazon.com/transcribe/latest/dg/getting-started-cli.html rel=noopener>https://docs.aws.amazon.com/transcribe/latest/dg/getting-started-cli.html</a></p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>Note down the response. This is the info you&rsquo;ll need to use this account. It is only shown once. I used to do this manually using their website, so you can do that if you want. It&rsquo;s actually surprisingly intuitive. Or you can just use these commands, which I&rsquo;ve already gathered, to do the same thing.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p>So back to Google it is. But it did give me a good starting point with which to search. <del>The final google string that found me what I needed: google &ldquo;aws transcribe command example&rdquo; -> &ldquo;
<a href=https://docs.aws.amazon.com/cli/latest/reference/transcribe/index.html%22 rel=noopener>https://docs.aws.amazon.com/cli/latest/reference/transcribe/index.html"</a> -> &ldquo;
<a href=https://docs.aws.amazon.com/cli/latest/reference/transcribe/start-transcription-job.html%22 rel=noopener>https://docs.aws.amazon.com/cli/latest/reference/transcribe/start-transcription-job.html"</a> or not</del>. I guess I keep trekking. google &ldquo;Error parsing parameter &lsquo;&ndash;media&rsquo;: Expected: &lsquo;=&rsquo;, received: &lsquo;EOF&rsquo; for input:&rdquo; ->
<a href=https://bobbyhadz.com/blog/aws-cli-error-parsing-parameter-expected-receved-eof rel=noopener>https://bobbyhadz.com/blog/aws-cli-error-parsing-parameter-expected-receved-eof</a> [doesn&rsquo;t apply to me] or
<a href=https://www.roelpeters.be/solve-error-parsing-parameter-expectedreceived-eof-for-input-aws-cli/ rel=noopener>https://www.roelpeters.be/solve-error-parsing-parameter-expectedreceived-eof-for-input-aws-cli/</a>. I&rsquo;m sure these&rsquo;ll help someone, but they don&rsquo;t help me. google &ldquo;aws cli transcribe expected =&rdquo; ->
<a href=https://docs.aws.amazon.com/transcribe/latest/dg/getting-started-cli.html rel=noopener>https://docs.aws.amazon.com/transcribe/latest/dg/getting-started-cli.html</a> FINALLY! It was able to handle spaces without a problem if you escaped them, as I&rsquo;d originally expected.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3 role=doc-endnote><p>since I was never able to figure out the arn (actually, maybe I finally did figure it out at 2:35 a.m., but then they hit me with another error: <code>Missing required parameter in InputDataConfig: "ContentType"</code>), I&rsquo;ll be switching to the simpler <code>aws translate translate-text</code> as shown in
<a href=https://docs.aws.amazon.com/translate/latest/dg/get-started-cli.html rel=noopener>their example</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://notes.smolkin.org/js/graph.6579af7b10c818dbd2ca038702db0224.js></script></div></div><div id=contact_buttons><footer><p>Made by M using <a href=https://smolkin.org/>Obsidian and Quartz</a>, © 2023</p><ul><li><a href=https://notes.smolkin.org/>Home</a></li><li><a href=https://twitter.com/MichaelSmolkin>X</a></li><li><a href=https://github.com/msmolkin>GitHub</a></li><li><a href=https://github.com/msmolkin1>GH2</a></li><li><a href=https://michael.smolkin.org/>About</a></li></ul></footer></div></div></body></html>